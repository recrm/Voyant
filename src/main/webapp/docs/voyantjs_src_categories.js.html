

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Source: voyantjs/src/categories.js | Voyant Tools Help</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-jsdoc.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/tui-doc.css">

    
</head>
<body>
<nav class="lnb" id="lnb">
    <div class="logo" style="width: 150px; height: 150px">
        
            <img src="imgs/info/about/icon.png" width="100%" height="100%">
        
    </div>
    <div class="title">
        <h1><a href="index.html" class="link">Voyant Tools Help</a></h1>
        
    </div>
    <div class="search-container" id="search-container">
        <input type="text" placeholder="Search">
        <ul></ul>
    </div>
    
        <ol class="lnb-tab">
            <li id="examples-tab">
                <a href="#"><h4>Voyant</h4></a>
            </li>            <li id="api-tab">
                <a href="#"><h4>Spyral</h4></a>
            </li>
        </ol>
    
    <div class="lnb-examples hidden"><h3>Voyant</h3><ul><li><a href="tutorial-guides.html">Guides</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="guides_sub"><div class="member-type">Guides</div><ul class="inner"><li><a href="tutorial-start.html">Getting Started</a></li><li><a href="tutorial-corpuscreator.html">Creating a Corpus</a></li><li><a href="tutorial-modifyingcorpus.html">Modifying a Corpus</a></li><li><a href="tutorial-embedding.html">Embedding Voyant</a></li><li><a href="tutorial-skins.html">Skins</a></li><li><a href="tutorial-languages.html">Languages</a></li><li><a href="tutorial-stopwords.html">Stopwords</a></li><li><a href="tutorial-categories.html">Categories</a></li><li><a href="tutorial-search.html">Search</a></li><li><a href="tutorial-palette.html">Palette</a></li><li><a href="tutorial-grids.html">Grids</a></li><li><a href="tutorial-new.html">What's New</a></li><li><a href="tutorial-tutorial.html">Tutorial/Workshop</a></li></ul></div></li><li><a href="tutorial-info.html">Information</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="info_sub"><div class="member-type">Guides</div><ul class="inner"><li><a href="tutorial-about.html">About</a></li><li><a href="tutorial-notebook.html">About Spyral</a></li><li><a href="tutorial-gallery.html">Gallery</a></li><li><a href="tutorial-mirrors.html">Mirrors</a></li><li><a href="tutorial-server.html">VoyantServer</a></li></ul></div></li><li><a href="tutorial-tools_.html">Tools</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="tools_sub"><div class="member-type">Guides</div><ul class="inner"><li><a href="tutorial-bubblelines_.html">Bubblelines</a></li><li><a href="tutorial-bubbles_.html">Bubbles</a></li><li><a href="tutorial-catalogue.html">Catalogue</a></li><li><a href="tutorial-cirrus_.html">Cirrus</a></li><li><a href="tutorial-corpuscollocates_.html">Corpus Collocates</a></li><li><a href="tutorial-collocatesgraph_.html">Collocates Graph</a></li><li><a href="tutorial-contexts_.html">Contexts</a></li><li><a href="tutorial-corpusterms_.html">Corpus Terms</a></li><li><a href="tutorial-correlations_.html">Correlations</a></li><li><a href="tutorial-documents_.html">Documents</a></li><li><a href="tutorial-documentterms_.html">Document Terms</a></li><li><a href="tutorial-dreamscape.html">Dreamscape</a></li><li><a href="tutorial-knots_.html">Knots</a></li><li><a href="tutorial-mandala_.html">Mandala</a></li><li><a href="tutorial-microsearch_.html">MicroSearch</a></li><li><a href="tutorial-phrases_.html">Phrases</a></li><li><a href="tutorial-reader_.html">Reader</a></li><li><a href="tutorial-rezoviz_.html">RezoViz</a></li><li><a href="tutorial-scatterplot_.html">ScatterPlot</a></li><li><a href="tutorial-streamgraph_.html">StreamGraph</a></li><li><a href="tutorial-summary_.html">Summary</a></li><li><a href="tutorial-termsberry_.html">TermsBerry</a></li><li><a href="tutorial-termsradio_.html">TermsRadio</a></li><li><a href="tutorial-textualarc_.html">TextualArc</a></li><li><a href="tutorial-topics_.html">Topics</a></li><li><a href="tutorial-trends_.html">Trends</a></li><li><a href="tutorial-veliza.html">Veliza</a></li><li><a href="tutorial-wordtree_.html">WordTree</a></li><li><a href="tutorial-via.html">Via</a></li></ul></div></li></ul></div><div class="lnb-api hidden"><h3>Namespaces</h3><ul><li><a href="Spyral.html">Spyral</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Spyral_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Spyral.Categories.html">Categories</a></li><li><a href="Spyral.Chart.html">Chart</a></li><li><a href="Spyral.Corpus.html">Corpus</a></li><li><a href="Spyral.Load.html">Load</a></li><li><a href="Spyral.Metadata.html">Metadata</a></li><li><a href="Spyral.NetworkGraph.html">NetworkGraph</a></li><li><a href="Spyral.Notebook.html">Notebook</a></li><li><a href="Spyral.Table.html">Table</a></li><li><a href="Spyral.Util.html">Util</a></li></ul></div></li><li><a href="Tools.html">Tools</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Tools_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Tools.Bubblelines.html">Bubblelines</a></li><li><a href="Tools.Bubbles.html">Bubbles</a></li><li><a href="Tools.Cirrus.html">Cirrus</a></li><li><a href="Tools.CollocatesGraph.html">CollocatesGraph</a></li><li><a href="Tools.Contexts.html">Contexts</a></li><li><a href="Tools.CorpusCollocates.html">CorpusCollocates</a></li><li><a href="Tools.CorpusTerms.html">CorpusTerms</a></li><li><a href="Tools.Correlations.html">Correlations</a></li><li><a href="Tools.DocumentTerms.html">DocumentTerms</a></li><li><a href="Tools.Documents.html">Documents</a></li><li><a href="Tools.Embedder.html">Embedder</a></li><li><a href="Tools.Knots.html">Knots</a></li><li><a href="Tools.Mandala.html">Mandala</a></li><li><a href="Tools.MicroSearch.html">MicroSearch</a></li><li><a href="Tools.Phrases.html">Phrases</a></li><li><a href="Tools.Reader.html">Reader</a></li><li><a href="Tools.RezoViz.html">RezoViz</a></li><li><a href="Tools.ScatterPlot.html">ScatterPlot</a></li><li><a href="Tools.StreamGraph.html">StreamGraph</a></li><li><a href="Tools.Summary.html">Summary</a></li><li><a href="Tools.TermsBerry.html">TermsBerry</a></li><li><a href="Tools.TermsRadio.html">TermsRadio</a></li><li><a href="Tools.TextualArc.html">TextualArc</a></li><li><a href="Tools.Topics.html">Topics</a></li><li><a href="Tools.Trends.html">Trends</a></li><li><a href="Tools.WordTree.html">WordTree</a></li></ul></div></li></ul></div><div class="lnb-api hidden"><h3>Classes</h3><ul><li><a href="CustomSet.html">CustomSet</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="CustomSet_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="CustomSet.html#.layout">layout</a></li><li><a href="CustomSet.html#.tableLayout">tableLayout</a></li></ul></div></li><li><a href="Panel.html">Panel</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Panel_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Panel.html#.corpus">corpus</a></li><li><a href="Panel.html#.input">input</a></li><li><a href="Panel.html#.inputFormat">inputFormat</a></li><li><a href="Panel.html#.subtitle">subtitle</a></li></ul></div></li><li><a href="Spyral.Util.Storage.html">Storage</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Spyral.Util.Storage_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Spyral.Util.Storage.html#.getStoredResource">getStoredResource</a></li><li><a href="Spyral.Util.Storage.html#.getTromboneUrl">getTromboneUrl</a></li><li><a href="Spyral.Util.Storage.html#.storeResource">storeResource</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="Spyral.Util.Storage.html#.getStoredResource">getStoredResource</a></li><li><a href="Spyral.Util.Storage.html#.getTromboneUrl">getTromboneUrl</a></li><li><a href="Spyral.Util.Storage.html#.storeResource">storeResource</a></li></ul></div></li></ul></div>
</nav>
<div id="resizer"></div>

<div class="main" id="main">
    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import Load from './load';

/**
 * Class for working with categories and features.
 * Categories are groupings of terms.
 * A term can be present in multiple categories. Category ranking is used to determine which feature value to prioritize.
 * Features are arbitrary properties (font, color) that are associated with each category.
 * @memberof Spyral
 * @class
 */
class Categories {

	/**
	 * Construct a new Categories class.
	 * 
	 * The following are valid in the config parameter:
	 * 
	 *  * **categories**: an object that maps arrays of terms to category names
	 *  * **categoriesRanking**: an array of category names that determines their ranking, from high to low
	 *  * **features**: an object that maps categories to feature names
	 *  * **featureDefaults**: an object that maps default feature value to feature names
	 * 
	 * An example:
	 * 
	 *  new Spyral.Categories({
	 *    categories: {
	 *      positive: ['good', 'happy'],
	 *      negative: ['bad', 'sad']
	 *    },
	 *    categoriesRanking: ['positive','negative'],
	 *    features: {color: {}},
	 *    featureDefaults: {color: '#333333'}
	 *  })
	 * @constructor
	 * @param {Object} config
	 * @param {Object} config.categories
	 * @param {Array} config.categoriesRanking
	 * @param {Object} config.features
	 * @param {Object} config.featureDefaults
	 * @returns {Spyral.Categories}
	 */
	constructor({categories, categoriesRanking, features, featureDefaults} = {categories: {}, categoriesRanking: [], features: {}, featureDefaults: {}}) {
		this.categories = categories;
		this.categoriesRanking = categoriesRanking;
		this.features = features;
		this.featureDefaults = featureDefaults;
	}

	/**
	 * Get the categories.
	 * @returns {Object}
	 */
	getCategories() {
		return this.categories;
	}
	
	/**
	 * Get category names as an array.
	 * @returns {Array}
	 */
	getCategoryNames() {
		return Object.keys(this.getCategories());
	}

	/**
	 * Get the terms for a category.
	 * @param {string} name The category name
	 * @returns {Array}
	 */
	getCategoryTerms(name) {
		return this.categories[name];
	}
	
	/**
	 * Add a new category.
	 * @param {string} name The category name
	 */
	addCategory(name) {
		if (this.categories[name] === undefined) {
			this.categories[name] = [];
			this.categoriesRanking.push(name);
		}
	}

	/**
	 * Rename a category.
	 * @param {string} oldName The old category name
	 * @param {string} newName The new category name
	 */
	renameCategory(oldName, newName) {
		if (oldName !== newName) {
			var terms = this.getCategoryTerms(oldName);
			var ranking = this.getCategoryRanking(oldName);
			this.addTerms(newName, terms);
			for (var feature in this.features) {
				var value = this.features[feature][oldName];
				this.setCategoryFeature(newName, feature, value);
			}
			this.removeCategory(oldName);
			this.setCategoryRanking(newName, ranking);
		}
	}

	/**
	 * Remove a category.
	 * @param {string} name The category name
	 */
	removeCategory(name) {
		delete this.categories[name];
		var index = this.categoriesRanking.indexOf(name);
		if (index !== -1) {
			this.categoriesRanking.splice(index, 1);
		}
		for (var feature in this.features) {
			delete this.features[feature][name];
		}
	}

	/**
	 * Gets the ranking for a category.
	 * @param {string} name The category name
	 * @returns {number}
	 */
	getCategoryRanking(name) {
		var ranking = this.categoriesRanking.indexOf(name);
		if (ranking === -1) {
			return undefined;
		} else {
			return ranking;
		}
	}

	/**
	 * Sets the ranking for a category.
	 * @param {string} name The category name
	 * @param {number} ranking The category ranking
	 */
	setCategoryRanking(name, ranking) {
		if (this.categories[name] !== undefined) {
			ranking = Math.min(this.categoriesRanking.length-1, Math.max(0, ranking));
			var index = this.categoriesRanking.indexOf(name);
			if (index !== -1) {
				this.categoriesRanking.splice(index, 1);
			}
			this.categoriesRanking.splice(ranking, 0, name);
		}
	}

	/**
	 * Add a term to a category.
	 * @param {string} category The category name
	 * @param {string} term The term
	 */
	addTerm(category, term) {
		this.addTerms(category, [term]);
	}

	/**
	 * Add multiple terms to a category.
	 * @param {string} category The category name
	 * @param {Array} terms An array of terms
	 */
	addTerms(category, terms) {
		if (!Array.isArray(terms)) {
			terms = [terms];
		}
		if (this.categories[category] === undefined) {
			this.addCategory(category);
		}
		for (var i = 0; i &lt; terms.length; i++) {
			var term = terms[i];
			if (this.categories[category].indexOf(term) === -1) {
				this.categories[category].push(term);
			}
		}
	}

	/**
	 * Remove a term from a category.
	 * @param {string} category The category name
	 * @param {string} term The term
	 */
	removeTerm(category, term) {
		this.removeTerms(category, [term]);
	}

	/**
	 * Remove multiple terms from a category.
	 * @param {string} category The category name
	 * @param {Array} terms An array of terms
	 */
	removeTerms(category, terms) {
		if (!Array.isArray(terms)) {
			terms = [terms];
		}
		if (this.categories[category] !== undefined) {
			for (var i = 0; i &lt; terms.length; i++) {
				var term = terms[i];
				var index = this.categories[category].indexOf(term);
				if (index !== -1) {
					this.categories[category].splice(index, 1);
				}
			}
		}
	}
	
	/**
	 * Get the category that a term belongs to, taking ranking into account.
	 * @param {string} term The term
	 * @returns {string}
	 */
	getCategoryForTerm(term) {
		var ranking = Number.MAX_VALUE;
		var cat = undefined;
		for (var category in this.categories) {
			if (this.categories[category].indexOf(term) !== -1 &amp;&amp; this.getCategoryRanking(category) &lt; ranking) {
				ranking = this.getCategoryRanking(category);
				cat = category;
			}
		}
		return cat;
	}

	/**
	 * Get all the categories a term belongs to.
	 * @param {string} term The term
	 * @returns {Array}
	 */
	getCategoriesForTerm(term) {
		var cats = [];
		for (var category in this.categories) {
			if (this.categories[category].indexOf(term) !== -1) {
				cats.push(category);
			}
		}
		return cats;
	}

	/**
	 * Get the feature for a term.
	 * @param {string} feature The feature
	 * @param {string} term The term
	 * @returns {*}
	 */
	getFeatureForTerm(feature, term) {
		return this.getCategoryFeature(this.getCategoryForTerm(term), feature);
	}
	
	/**
	 * Get the features.
	 * @returns {Object}
	 */
	getFeatures() {
		return this.features;
	}

	/**
	 * Add a feature.
	 * @param {string} name The feature name
	 * @param {*} defaultValue The default value
	 */
	addFeature(name, defaultValue) {
		if (this.features[name] === undefined) {
			this.features[name] = {};
		}
		if (defaultValue !== undefined) {
			this.featureDefaults[name] = defaultValue;
		}
	}

	/**
	 * Remove a feature.
	 * @param {string} name The feature name
	 */
	removeFeature(name) {
		delete this.features[name];
		delete this.featureDefaults[name];
	}

	/**
	 * Set the feature for a category.
	 * @param {string} categoryName The category name
	 * @param {string} featureName The feature name
	 * @param {*} featureValue The feature value
	 */
	setCategoryFeature(categoryName, featureName, featureValue) {
		if (this.features[featureName] === undefined) {
			this.addFeature(featureName);
		}
		this.features[featureName][categoryName] = featureValue;
	}

	/**
	 * Get the feature for a category.
	 * @param {string} categoryName The category name
	 * @param {string} featureName The feature name
	 * @returns {*}
	 */
	getCategoryFeature(categoryName, featureName) {
		var value = undefined;
		if (this.features[featureName] !== undefined) {
			value = this.features[featureName][categoryName];
			if (value === undefined) {
				value = this.featureDefaults[featureName];
				if (typeof value === 'function') {
					value = value();
				}
			}
		}
		return value;
	}
	
	/**
	 * Get a copy of the category and feature data.
	 * @returns {Object}
	 */
	getCategoryExportData() {
		return {
			categories: Object.assign({}, this.categories),
			categoriesRanking: this.categoriesRanking.map(x => x),
			features: Object.assign({}, this.features)
		};
	}
	
	/**
	 * Save the categories (if we're in a recognized environment).
	 * @param {Object} config for the network call (specifying if needed the location of Trombone, etc., see {@link Spyral.Load#trombone}
	 * @returns {Promise&lt;string>} this returns a promise which eventually resolves to a string that is the ID reference for the stored categories
	 */
	save(config={},api={}) {
		const categoriesData = JSON.stringify(this.getCategoryExportData());
		return Load.trombone(api, Object.assign(config, {
			tool: 'resource.StoredCategories',
			storeResource: categoriesData
		})).then(data => data.storedCategories.id);
		// TODO save id as property
		// TODO somehow cache id so that it's not resaved everytime notebook is run
	}
	
	/**
	 * Load the categories (if we're in a recognized environment).
	 * 
	 * In its simplest form this can be used with a single string ID to load:
	 * 	new Spyral.Categories().load("categories.en.txt")
	 * 
	 * Which is equivalent to:
	 * 	new Spyral.Categories().load({retrieveResourceId: "categories.en.txt"});
	 * 
	 * @param {(Object|String)} config an object specifying the parameters (see above)
	 * @param {Object} api an object specifying any parameters for the trombone call
	 * @returns {Promise&lt;Object>} this first returns a promise and when the promise is resolved it returns this categories object (with the loaded data included)
	 */
	load(config={}, api={}) {
		let me = this;
		if (typeof config === 'string') {
			config =  {'retrieveResourceId': config};
		}
		if (!('retrieveResourceId' in config)) {
			throw Error('You must provide a value for the retrieveResourceId parameter');
		}
		return Load.trombone(api, Object.assign(config, {
			tool: 'resource.StoredCategories'
		})).then(data => {
			const cats = JSON.parse(data.storedCategories.resource);
			me.features = cats.features;
			me.categories = cats.categories;
			me.categoriesRanking = cats.categoriesRanking || [];
			if (me.categoriesRanking.length === 0) {
				for (var category in me.categories) {
					me.categoriesRanking.push(category);
				}
			}
			return me;
		});
	}

	/**
	 * Load categories and return a promise that resolves to a new Spyral.Categories instance.
	 * 
	 * @param {(Object|String)} config an object specifying the parameters (see above)
	 * @param {Object} api an object specifying any parameters for the trombone call
	 * @returns {Promise&lt;Object>} this first returns a promise and when the promise is resolved it returns this categories object (with the loaded data included)
	 */
	static load(config={}, api={}) {
		const categories = new Categories();
		return categories.load(config, api);
	}
}

export default Categories;
</code></pre>
        </article>
    </section>




</div>

<footer>
    <div class="footer-text"><a href='https://creativecommons.org/licenses/by/4.0/' style='text-decoration: none; color: black;'>© Stéfan Sinclair & Geoffrey Rockwell</a></div>
</footer>
<script>prettyPrint();</script>
<script src="scripts/jquery.min.js"></script>
<script src="scripts/tui-doc.js"></script>
<script src="scripts/linenumber.js"></script>

    <script>
        var id = '_sub'.replace(/"/g, '_');
        var selectedApi = document.getElementById(id); // do not use jquery selector
        var $selectedApi = $(selectedApi);

        $selectedApi.removeClass('hidden');
        $selectedApi.parent().find('.glyphicon').removeClass('glyphicon-plus').addClass('glyphicon-minus');
        showLnbExamples();
    </script>

</body>
</html>
