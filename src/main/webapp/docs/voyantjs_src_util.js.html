

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Source: voyantjs/src/util.js | Voyant Tools Help</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-jsdoc.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/tui-doc.css">

    
</head>
<body>
<nav class="lnb" id="lnb">
    <div class="logo" style="width: 150px; height: 150px">
        
            <img src="imgs/info/about/icon.png" width="100%" height="100%">
        
    </div>
    <div class="title">
        <h1><a href="index.html" class="link">Voyant Tools Help</a></h1>
        
    </div>
    <div class="search-container" id="search-container">
        <input type="text" placeholder="Search">
        <ul></ul>
    </div>
    
        <ol class="lnb-tab">
            <li id="examples-tab">
                <a href="#"><h4>Voyant</h4></a>
            </li>            <li id="api-tab">
                <a href="#"><h4>Spyral</h4></a>
            </li>
        </ol>
    
    <div class="lnb-examples hidden"><h3>Voyant</h3><ul><li><a href="tutorial-guides.html">Guides</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="guides_sub"><div class="member-type">Guides</div><ul class="inner"><li><a href="tutorial-start.html">Getting Started</a></li><li><a href="tutorial-corpuscreator.html">Creating a Corpus</a></li><li><a href="tutorial-modifyingcorpus.html">Modifying a Corpus</a></li><li><a href="tutorial-embedding.html">Embedding Voyant</a></li><li><a href="tutorial-skins.html">Skins</a></li><li><a href="tutorial-languages.html">Languages</a></li><li><a href="tutorial-stopwords.html">Stopwords</a></li><li><a href="tutorial-categories.html">Categories</a></li><li><a href="tutorial-search.html">Search</a></li><li><a href="tutorial-palette.html">Palette</a></li><li><a href="tutorial-grids.html">Grids</a></li><li><a href="tutorial-new.html">What's New</a></li><li><a href="tutorial-tutorial.html">Tutorial/Workshop</a></li></ul></div></li><li><a href="tutorial-info.html">Information</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="info_sub"><div class="member-type">Guides</div><ul class="inner"><li><a href="tutorial-about.html">About</a></li><li><a href="tutorial-notebook.html">About Spyral</a></li><li><a href="tutorial-gallery.html">Gallery</a></li><li><a href="tutorial-mirrors.html">Mirrors</a></li><li><a href="tutorial-server.html">VoyantServer</a></li></ul></div></li><li><a href="tutorial-tools_.html">Tools</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="tools_sub"><div class="member-type">Guides</div><ul class="inner"><li><a href="tutorial-bubblelines_.html">Bubblelines</a></li><li><a href="tutorial-bubbles_.html">Bubbles</a></li><li><a href="tutorial-catalogue.html">Catalogue</a></li><li><a href="tutorial-cirrus_.html">Cirrus</a></li><li><a href="tutorial-corpuscollocates_.html">Corpus Collocates</a></li><li><a href="tutorial-collocatesgraph_.html">Collocates Graph</a></li><li><a href="tutorial-contexts_.html">Contexts</a></li><li><a href="tutorial-corpusterms_.html">Corpus Terms</a></li><li><a href="tutorial-correlations_.html">Correlations</a></li><li><a href="tutorial-documents_.html">Documents</a></li><li><a href="tutorial-documentterms_.html">Document Terms</a></li><li><a href="tutorial-dreamscape.html">Dreamscape</a></li><li><a href="tutorial-knots_.html">Knots</a></li><li><a href="tutorial-mandala_.html">Mandala</a></li><li><a href="tutorial-microsearch_.html">MicroSearch</a></li><li><a href="tutorial-phrases_.html">Phrases</a></li><li><a href="tutorial-reader_.html">Reader</a></li><li><a href="tutorial-rezoviz_.html">RezoViz</a></li><li><a href="tutorial-scatterplot_.html">ScatterPlot</a></li><li><a href="tutorial-streamgraph_.html">StreamGraph</a></li><li><a href="tutorial-summary_.html">Summary</a></li><li><a href="tutorial-termsberry_.html">TermsBerry</a></li><li><a href="tutorial-termsradio_.html">TermsRadio</a></li><li><a href="tutorial-textualarc_.html">TextualArc</a></li><li><a href="tutorial-topics_.html">Topics</a></li><li><a href="tutorial-trends_.html">Trends</a></li><li><a href="tutorial-veliza.html">Veliza</a></li><li><a href="tutorial-wordtree_.html">WordTree</a></li><li><a href="tutorial-via.html">Via</a></li></ul></div></li></ul></div><div class="lnb-api hidden"><h3>Namespaces</h3><ul><li><a href="Spyral.html">Spyral</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Spyral_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Spyral.Categories.html">Categories</a></li><li><a href="Spyral.Chart.html">Chart</a></li><li><a href="Spyral.Corpus.html">Corpus</a></li><li><a href="Spyral.Load.html">Load</a></li><li><a href="Spyral.Metadata.html">Metadata</a></li><li><a href="Spyral.NetworkGraph.html">NetworkGraph</a></li><li><a href="Spyral.Notebook.html">Notebook</a></li><li><a href="Spyral.Table.html">Table</a></li><li><a href="Spyral.Util.html">Util</a></li></ul></div></li><li><a href="Tools.html">Tools</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Tools_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Tools.Bubblelines.html">Bubblelines</a></li><li><a href="Tools.Bubbles.html">Bubbles</a></li><li><a href="Tools.Cirrus.html">Cirrus</a></li><li><a href="Tools.CollocatesGraph.html">CollocatesGraph</a></li><li><a href="Tools.Contexts.html">Contexts</a></li><li><a href="Tools.CorpusCollocates.html">CorpusCollocates</a></li><li><a href="Tools.CorpusTerms.html">CorpusTerms</a></li><li><a href="Tools.Correlations.html">Correlations</a></li><li><a href="Tools.DocumentTerms.html">DocumentTerms</a></li><li><a href="Tools.Documents.html">Documents</a></li><li><a href="Tools.Embedder.html">Embedder</a></li><li><a href="Tools.Knots.html">Knots</a></li><li><a href="Tools.Mandala.html">Mandala</a></li><li><a href="Tools.MicroSearch.html">MicroSearch</a></li><li><a href="Tools.Phrases.html">Phrases</a></li><li><a href="Tools.Reader.html">Reader</a></li><li><a href="Tools.RezoViz.html">RezoViz</a></li><li><a href="Tools.ScatterPlot.html">ScatterPlot</a></li><li><a href="Tools.StreamGraph.html">StreamGraph</a></li><li><a href="Tools.Summary.html">Summary</a></li><li><a href="Tools.TermsBerry.html">TermsBerry</a></li><li><a href="Tools.TermsRadio.html">TermsRadio</a></li><li><a href="Tools.TextualArc.html">TextualArc</a></li><li><a href="Tools.Topics.html">Topics</a></li><li><a href="Tools.Trends.html">Trends</a></li><li><a href="Tools.WordTree.html">WordTree</a></li></ul></div></li></ul></div><div class="lnb-api hidden"><h3>Classes</h3><ul><li><a href="CustomSet.html">CustomSet</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="CustomSet_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="CustomSet.html#.layout">layout</a></li><li><a href="CustomSet.html#.tableLayout">tableLayout</a></li></ul></div></li><li><a href="Panel.html">Panel</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Panel_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Panel.html#.corpus">corpus</a></li><li><a href="Panel.html#.input">input</a></li><li><a href="Panel.html#.inputFormat">inputFormat</a></li><li><a href="Panel.html#.subtitle">subtitle</a></li></ul></div></li><li><a href="Spyral.Util.Storage.html">Storage</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Spyral.Util.Storage_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Spyral.Util.Storage.html#.getStoredResource">getStoredResource</a></li><li><a href="Spyral.Util.Storage.html#.getTromboneUrl">getTromboneUrl</a></li><li><a href="Spyral.Util.Storage.html#.storeResource">storeResource</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="Spyral.Util.Storage.html#.getStoredResource">getStoredResource</a></li><li><a href="Spyral.Util.Storage.html#.getTromboneUrl">getTromboneUrl</a></li><li><a href="Spyral.Util.Storage.html#.storeResource">storeResource</a></li></ul></div></li></ul></div>
</nav>
<div id="resizer"></div>

<div class="main" id="main">
    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * A helper for working with the Voyant Notebook app.
 * @memberof Spyral
 */
class Util {

	/**
	 * Generates a random ID of the specified length.
	 * @param {Number} len The length of the ID to generate?
	 * @returns {String}
	 */
	static id(len = 8) {
		// based on https://stackoverflow.com/a/13403498
		const times = Math.ceil(len / 11);
		let id = '';
		for (let i = 0; i &lt; times; i++) {
			id += Math.random().toString(36).substring(2); // the result of this is 11 characters long
		}
		const letters = 'abcdefghijklmnopqrstuvwxyz';
		id = letters[Math.floor(Math.random()*26)] + id; // ensure the id starts with a letter
		return id.substring(0, len);
	}

	/**
	 * 
	 * @param {Array|Object|String} contents 
	 * @returns {String}
	 */
	static toString(contents) {
		if (contents.constructor === Array || contents.constructor===Object) {
			contents = JSON.stringify(contents);
			if (contents.length>500) {
				contents = '&lt;svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">&lt;path d="M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"/>&lt;path d="M0 0h24v24H0z" fill="none"/>&lt;/svg>'+contents.substring(0,500)+' &lt;a href="">+&lt;/a>&lt;div style="display: none">'+contents.substring(501)+'&lt;/div>';
			}
		}
		return contents.toString();
	}

	/**
	 * 
	 * @param {String} before 
	 * @param {String} more 
	 * @param {String} after 
	 */
	static more(before, more, after) {
		return before + '&lt;svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">&lt;path d="M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"/>&lt;path d="M0 0h24v24H0z" fill="none"/>&lt;/svg>'+more.substring(0,500)+' &lt;a href="">+&lt;/a>&lt;div style="display: none">'+more.substring(501)+'&lt;/div>' + after;
	}


	/**
	 * Take a data URL and convert it to a Blob.
	 * @param {String} dataUrl 
	 * @returns {Blob}
	 */
	static dataUrlToBlob(dataUrl) {
		const parts = dataUrl.split(',');
		const byteString = atob(parts[1]);
		const mimeString = parts[0].split(':')[1].split(';')[0];
		
		const ab = new ArrayBuffer(byteString.length);
		const ia = new Uint8Array(ab);
		for (let i = 0; i &lt; byteString.length; i++) {
			ia[i] = byteString.charCodeAt(i);
		}
		
		return new Blob([ab], {type: mimeString});
	}

	/**
	 * Take a Blob and convert it to a data URL.
	 * @param {Blob} blob 
	 * @returns {Promise&lt;String>} a Promise for a data URL
	 */
	static blobToDataUrl(blob) {
		return new Promise((resolve, reject) => {
			const fr = new FileReader();
			fr.onload = function(e) {
				resolve(e.target.result);
			};
	
			try {
				fr.readAsDataURL(blob);
			} catch(e) {
				reject(e);
			}
		});
	}

	/**
	 * Take a Blob and convert it to a String.
	 * @param {Blob} blob 
	 * @returns {Promise&lt;String>} a Promise for a String
	 */
	static blobToString(blob) {
		return new Promise((resolve, reject) => {
			const reader = new FileReader();
			reader.addEventListener('loadend', function(ev) {
				try {
					const td = new TextDecoder();
					const data = td.decode(ev.target.result);
					resolve(data);
				} catch (err) {
					reject(err);
				}
			});
			reader.readAsArrayBuffer(blob);
		});
	}

	/**
	 * Takes an XML document and XSL stylesheet and returns the resulting transformation.
	 * @param {(Document|String)} xmlDoc The XML document to transform
	 * @param {(Document|String)} xslStylesheet The XSL to use for the transformation
	 * @param {Boolean} [returnDoc=false] True to return a Document, false to return a DocumentFragment
	 * @returns {Document}
	 */
	static transformXml(xmlDoc, xslStylesheet, returnDoc=false) {
		if (this.isString(xmlDoc)) {
			const parser = new DOMParser();
			xmlDoc = parser.parseFromString(xmlDoc, 'application/xml');
			const error = this._getParserError(xmlDoc);
			if (error) {
				throw error;
			}
		}
		if (this.isString(xslStylesheet)) {
			const parser = new DOMParser();
			xslStylesheet = parser.parseFromString(xslStylesheet, 'application/xml');
			const error = this._getParserError(xslStylesheet);
			if (error) {
				throw error;
			}
		}
		const xslRoot = xslStylesheet.firstElementChild;
		if (xslRoot.hasAttribute('version') === false) {
			// Transform fails in Firefox if version is missing, so return a more helpful error message instead of the default.
			throw new Error('XSL stylesheet is missing version attribute.');
		}

		const xsltProcessor = new XSLTProcessor();
		try {
			xsltProcessor.importStylesheet(xslStylesheet);
		} catch (e) {
			console.warn(e);
		}
		let result;
		if (returnDoc) {
			result = xsltProcessor.transformToDocument(xmlDoc);
		} else {
			result = xsltProcessor.transformToFragment(xmlDoc, document);
		}
		return result;
	}

	/**
	 * Checks the Document for a parser error and returns an Error if found, or null.
	 * @ignore
	 * @param {Document} doc 
	 * @param {Boolean} [includePosition=false] True to include the error position information
	 * @returns {Error|null}
	 */
	static _getParserError(doc, includePosition=false) {
		// fairly naive check for parsererror, consider something like https://stackoverflow.com/a/55756548
		const parsererror = doc.querySelector('parsererror');
		if (parsererror !== null) {
			const errorMsg = parsererror.textContent;
			const error = new Error(errorMsg);
			if (includePosition) {
				const lineNumber = parseInt(errorMsg.match(/line[\s\w]+?(\d+)/i)[1]);
				const columnNumber = parseInt(errorMsg.match(/column[\s\w]+?(\d+)/i)[1]);
				error.lineNumber = lineNumber;
				error.columnNumber = columnNumber;
			}
			return error;
		} else {
			return null;
		}
	}

	/**
	 * Returns true if the value is a String.
	 * @param {*} val 
	 * @returns {Boolean} 
	 */
	static isString(val) {
		return typeof val === 'string';
	}

	/**
	 * Returns true if the value is a Number.
	 * @param {*} val 
	 * @returns {Boolean}
	 */
	static isNumber(val) {
		return typeof val === 'number';
	}

	/**
	 * Returns true if the value is a Boolean.
	 * @param {*} val 
	 * @returns {Boolean}
	 */
	static isBoolean(val) {
		return typeof val === 'boolean';
	}

	/**
	 * Returns true if the value is Undefined.
	 * @param {*} val 
	 * @returns {Boolean}
	 */
	static isUndefined(val) {
		return typeof val === 'undefined';
	}

	/**
	 * Returns true if the value is an Array.
	 * @param {*} val 
	 * @returns {Boolean}
	 */
	static isArray(val) {
		return Object.prototype.toString.call(val) === '[object Array]';
	}

	/**
	 * Returns true if the value is an Object.
	 * @param {*} val 
	 * @returns {Boolean}
	 */
	static isObject(val) {
		return Object.prototype.toString.call(val) === '[object Object]';
	}

	/**
	 * Returns true if the value is Null.
	 * @param {*} val 
	 * @returns {Boolean}
	 */
	static isNull(val) {
		return Object.prototype.toString.call(val) === '[object Null]';
	}

	/**
	 * Returns true if the value is a Node.
	 * @param {*} val 
	 * @returns {Boolean}
	 */
	static isNode(val) {
		return val instanceof Node;
	}

	/**
	 * Returns true if the value is a Function.
	 * @param {*} val 
	 * @returns {Boolean}
	 */
	static isFunction(val) {
		const typeString = Object.prototype.toString.call(val);
		return typeString === '[object Function]' || typeString === '[object AsyncFunction]';
	}

	/**
	 * Returns true if the value is a Promise.
	 * @param {*} val 
	 * @returns {Boolean}
	 */
	static isPromise(val) {
		// ES6 promise detection
		// return Object.prototype.toString.call(val) === '[object Promise]';
		
		// general promise detection
		return !!val &amp;&amp; (typeof val === 'object' || typeof val === 'function') &amp;&amp; typeof val.then === 'function';
	}

	/**
	 * Returns true if the value is a Blob.
	 * @param {*} val 
	 * @returns {Boolean}
	 */
	static isBlob(val) {
		return val instanceof Blob;
	}

	/**
	 * Takes a MIME type and returns the related file extension.
	 * Only handles file types supported by Voyant.
	 * @param {String} mimeType 
	 * @returns {String}
	 */
	static getFileExtensionFromMimeType(mimeType) {
		mimeType = mimeType.trim().toLowerCase();
		switch (mimeType) {
		case 'application/atom+xml':
			return 'xml';
		case 'application/rss+xml':
			return 'xml';
		case 'application/xml':
			return 'xml';
		case 'text/xml':
			return 'xml';
		case 'application/xhtml+xml':
			return 'xhtml';
		case 'text/html':
			return 'html';
		case 'text/plain':
			return 'txt';
		case 'application/pdf':
			return 'pdf';
		case 'application/json':
			return 'json';
		case 'application/vnd.apple.pages':
			return 'pages';
		case 'application/rtf':
			return 'rtf';
		case 'application/vnd.oasis.opendocument.text':
			return 'odt';
		case 'application/epub+zip':
			return 'epub';
		case 'application/msword':
			return 'doc';
		case 'application/vnd.openxmlformats-officedocument.wordprocessingml.document':
			return 'docx';
		case 'application/vnd.ms-excel':
			return 'xls';
		case 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet':
			return 'xlsx';
		case 'application/zip':
			return 'zip';
		case 'application/gzip':
			return 'gzip';
		case 'application/x-bzip2':
			return 'bzip2';
		default:
			if (mimeType.indexOf('text') === 0) {
				return 'txt'; // fallback
			} else {
				return undefined;
			}
		}
	}

	/**
	 * Takes a file extension and returns the corresponding Voyant Document Format name.
	 * @param {String} fileExtension 
	 * @returns {String}
	 */
	static getVoyantDocumentFormatFromFileExtension(fileExtension) {
		fileExtension = fileExtension.trim().toLowerCase();
		switch(fileExtension) {
		case 'txt':
			return 'text';
		case 'xhtml':
			return 'html';
		case 'doc':
			return 'msword';
		case 'docx':
			return 'mswordx';
		case 'xls':
			return 'xlsx';
		case 'zip':
			return 'archive';
		case 'gzip':
		case 'bzip2':
			return 'compressed';
		default:
			return fileExtension;
		}
	}
}

export default Util;
</code></pre>
        </article>
    </section>




</div>

<footer>
    <div class="footer-text"><a href='https://creativecommons.org/licenses/by/4.0/' style='text-decoration: none; color: black;'>© Stéfan Sinclair & Geoffrey Rockwell</a></div>
</footer>
<script>prettyPrint();</script>
<script src="scripts/jquery.min.js"></script>
<script src="scripts/tui-doc.js"></script>
<script src="scripts/linenumber.js"></script>

    <script>
        var id = '_sub'.replace(/"/g, '_');
        var selectedApi = document.getElementById(id); // do not use jquery selector
        var $selectedApi = $(selectedApi);

        $selectedApi.removeClass('hidden');
        $selectedApi.parent().find('.glyphicon').removeClass('glyphicon-plus').addClass('glyphicon-minus');
        showLnbExamples();
    </script>

</body>
</html>
